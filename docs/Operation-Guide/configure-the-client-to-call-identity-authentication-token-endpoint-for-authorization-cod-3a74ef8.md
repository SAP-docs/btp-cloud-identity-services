<!-- loio3a74ef862743445fb5d37f1afe1fe0a0 -->

# Configure the Client to Call Identity Authentication Token Endpoint for Authorization Code Flow

The token endpoint is used to get the user's access token, id token and refresh token.



This document explains how to call the token endpoint and what are the parameters supported by Identity Authentication.



<a name="loio3a74ef862743445fb5d37f1afe1fe0a0__section_lyw_cqf_n2c"/>

## Prerequisites

-   For your business application, there’s an OpenID Connect \(OIDC\) application in Identity Authentication.

    For more information, see [Create OpenID Connect \(OIDC\) Application](create-openid-connect-oidc-application-62fb1c3.md).

-   For your OpenID Connect \(OIDC\) application in Identity Authentication, you've prepared an authentication credential for the API call. The API supports the following authentication schemes:

    -   Basic

        For more information, see `Authorization` in the *Request Header* table below.

    -   X.509

        For more information, see `Authorization` in the *Request Header* table below.

    -   JWT \(client\_assertion\)

        -   Trust by issuer: You must include the `client_id` in the request.

        -   Trust by URI: Including `client_id` in the request is optional.


        For more information, see the *Request Parameters* table below.


    For more information, see [API Authentication](api-authentication-9d200d5.md).




## **Request**

**URI:**<code>https://&lt;Cloud Identity Services domain&gt;/oauth2/token</code>

> ### Note:  
> The domain part has the following pattern:
> 
> `<tenant ID>.accounts.ondemand.com` or `<tenant ID>.accounts.cloud.sap`. If you have a configured custom domain, the domain has the following pattern: <your custom domain\>.
> 
> *Tenant ID* is an automatically generated ID by the system. The first administrator created for the tenant receives an activation email with a URL in it. This URL contains the *tenant ID*. For more information about your tenants, see [View Assigned Tenants and Administrators](../view-assigned-tenants-and-administrators-f56e6f2.md).

**HTTP Method:***POST*



### Request Headers


<table>
<tr>
<th valign="top">

Header

</th>
<th valign="top">

Required

</th>
<th valign="top">

Values

</th>
</tr>
<tr>
<td valign="top">

`Content-Type`

</td>
<td valign="top">

Yes

</td>
<td valign="top">

application/x-www-form-urlencoded

</td>
</tr>
</table>



### Request Parameters


<table>
<tr>
<th valign="top">

Parameter

</th>
<th valign="top">

Required

</th>
<th valign="top">

Data Type

</th>
<th valign="top">

Description

</th>
<th valign="top">

Parameter Type

</th>
</tr>
<tr>
<td valign="top">

`grant_type`

</td>
<td valign="top">

Yes

</td>
<td valign="top">

string

</td>
<td valign="top">

authorization\_code

</td>
<td valign="top">

Request body

</td>
</tr>
<tr>
<td valign="top">

`code`

</td>
<td valign="top">

Yes

</td>
<td valign="top">

string

</td>
<td valign="top">

The `code` generated by Identity Authentication in the `authorize` endpoint. It's returned with the response from the `authorize` endpoint.

> ### Note:  
> The `code` parameter can be used within 2 minutes after it generated and returned in the URL. It can be used only once.



</td>
<td valign="top">

Request body

</td>
</tr>
<tr>
<td valign="top">

`redirect_uri`

</td>
<td valign="top">

Yes

</td>
<td valign="top">

string

</td>
<td valign="top">

The same URL that has been sent with the authorization request. For more information, see [Configure OpenID Connect \(OIDC\) Application](configure-openid-connect-oidc-application-8a0aa2e.md).

</td>
<td valign="top">

Request body

</td>
</tr>
<tr>
<td valign="top">

`client_id`

</td>
<td valign="top">

Yes

</td>
<td valign="top">

string

</td>
<td valign="top">

Used to identify the corresponding Identity Authentication application.

> ### Note:  
> The `client_id` parameter is optional if the request is provided with authentication.



</td>
<td valign="top">

Request body

</td>
</tr>
<tr>
<td valign="top">

`code_verifier`

</td>
<td valign="top">

No

</td>
<td valign="top">

string

</td>
<td valign="top">

Validation value for the `code_challenge`. Required for PKCE.

</td>
<td valign="top">

Request body

</td>
</tr>
<tr>
<td valign="top">

`refresh_expiry`

</td>
<td valign="top">

No

</td>
<td valign="top">

string

</td>
<td valign="top">

Reduces the expiry of a refresh token. It is useful if your application is called from mobile and web applications, and both have different session requirements. If you set the token lifetime to 0 or less, you won't receive a `refresh_token` in response.

</td>
<td valign="top">

Request body

</td>
</tr>
<tr>
<td valign="top">

`max_exchange_period`

</td>
<td valign="top">

No

</td>
<td valign="top">

string

</td>
<td valign="top">

You can set а limit on how long the application can exchange user tokens without re-authenticating after having acquired the initial token. The `max_exchange_period` parameter has a numeric value which can be set at between 1 hour and 4320 hours \(six months\).

> ### Remember:  
> If the `max_exchange_period` value is smaller than the configuration defined in token policy, this value overrides the configuration defined in token policy configuration and propagates it once the token is exchanged or refreshed. If the value is bigger, it is ignored and the configuration defined in token policy is taken into consideration. For more information, see [Token Policy Configuration for Applications](token-policy-configuration-for-applications-c4ba52e.md)



</td>
<td valign="top">

Request body

</td>
</tr>
<tr>
<td valign="top">

`token_format`

</td>
<td valign="top">

No

</td>
<td valign="top">

string

</td>
<td valign="top">

The `token_format` can be set to `opaque` to retrieve an opaque access token or to `jwt` to retrieve a JWT-based access token. If not set, the current defaults per grant type are used.

</td>
<td valign="top">

Request body

</td>
</tr>
<tr>
<td valign="top">

`app_tid`

</td>
<td valign="top">

No

</td>
<td valign="top">

string

</td>
<td valign="top">

Reserved.

</td>
<td valign="top">

Path

</td>
</tr>
</table>



### Request Example

```
grant_type=authorization_code&client_id=12b52d2c-1q34-5r5t-a576-75e85asdf523&code=768fsd1206we951236729134fa4a247ee&redirect_uri=https://www.example.com
```





### Request Example with PKCE

```
grant_type=authorization_code&client_id=23q45d2c-1e98-4c7f-a576-69e85dddb456&code=b1d87f103c9f4c8a936a2f164c8728a0&redirect_uri=https://www.example.com&code_verifier=e4yAeaa_OLJ-8ZC1sj6JWFqgRK8QR-egfqG4lQlsy0~NOrjOcVdIpPxPvUEsG1Il1LP76F0MGr4a0miVD2Z84Gn_Lw67BhZ9GQDTF6wN_fUwQtJJeN3bnvk7J.Ty6jDi
```



## **Response**



### Response Status and Error Codes


<table>
<tr>
<th valign="top">

Code

</th>
<th valign="top">

Reason

</th>
<th valign="top">

Description

</th>
</tr>
<tr>
<td valign="top">

200 OK

</td>
<td valign="top">

Successful operation.

</td>
<td valign="top">

Returns `access_token`, `refresh_token`, and `id_token`.

> ### Note:  
> The `refresh_token` is used to obtain a new `id_token` and `access_token` when the current token becomes invalid or expires. For more information, see [Call Identity Authentication Refresh Token](call-identity-authentication-refresh-token-c62c09e.md).
> 
> The `id_token` is in the form of a JWT \(JSON Web Token\) and contains information about the user. The `id_token` is valid for 60 minutes.



</td>
</tr>
<tr>
<td valign="top">

400 Bad Request

</td>
<td valign="top">

Missing or wrong parameter.

</td>
<td valign="top">

Returns information about the error.

</td>
</tr>
</table>



### Response Payload Example

```

{
 "access_token": 
"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIxMmEzNGI1Yy02ZDc4LTl
lMWYtZzM0NS02N2g4OWlqa2wxMjMiLCJzdWIiOiJQMTIzNDU2IiwibWFpbCI6ImRvbmEu
bW9vcmVAZXhhbXBsZS5jb20iLCJpc3MiOiJodHRwczovL215LXRlbmFudC5hY2NvdW50c
y5vbmRlbWFuZC5jb20iLCJsYXN0X25hbWUiOiJNb29yZSIsInNhcF91aWQiOiIxMjM0NT
ZhYmM3ZGU4LWZnaGktOTEyMy1qNDU2LTc4OTEya2wzNG01NiIsImV4cCI6MTU4ODAxOTA
0NCwiaWF0IjoxNTg4MDEzNzYwLCJub25jZSI6Im0tMEc2X0ZhUzNLZyIsImZpcnN0X25h
bWUiOiJEb25hIiwianRpIjoiMzhlNDIzMzAtZGU3YS00MTMwLWEzYTEtYjU4MmI1MjhkY
Tk4In0.J-aygbQ8IQlw4KD2t1hTPB2gyu3NdTbINDJ9eRs997g",
 "refresh_token": "d12a12abcd198765dd54r456e98321",
 "id_token": 
"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIxMmEzNGI1Yy02ZDc4LTl
lMWYtZzM0NS02N2g4OWlqa2wxMjMiLCJzdWIiOiJQMTIzNDU2IiwibWFpbCI6ImRvbmEu
bW9vcmVAZXhhbXBsZS5jb20iLCJpc3MiOiJodHRwczovL215LXRlbmFudC5hY2NvdW50c
y5vbmRlbWFuZC5jb20iLCJsYXN0X25hbWUiOiJNb29yZSIsInNhcF91aWQiOiIxMjM0NT
ZhYmM3ZGU4LWZnaGktOTEyMy1qNDU2LTc4OTEya2wzNG01NiIsImV4cCI6MTU4ODAxOTA
0NCwiaWF0IjoxNTg4MDEzNzYwLCJub25jZSI6Im0tMEc2X0ZhUzNLZyIsImZpcnN0X25h
bWUiOiJEb25hIiwianRpIjoiMzhlNDIzMzAtZGU3YS00MTMwLWEzYTEtYjU4MmI1MjhkY
Tk4In0.J-aygbQ8IQlw4KD2t1hTPB2gyu3NdTbINDJ9eRs997g",
 "token_type": "Bearer",
 "expires_in": 3600
}
```

> ### Note:  
> The format of the `issuer` depends on the configuration in the administration console for SAP Cloud Identity Services. For more information, see [Tenant OpenID Connect \(OIDC\) Configurations](tenant-openid-connect-oidc-configurations-3d6abcc.md).



**Related Information**  


[Configuring OpenID Connect \(OIDC\)](configuring-openid-connect-oidc-a789c9c.md "You can use Identity Authentication for authentication in OpenID Connect (OIDC) protected applications.")

[Configure the Client to Call Identity Authentication Authorize Endpoint for Authorization Code Flow with PKCE](configure-the-client-to-call-identity-authentication-authorize-endpoint-for-authorization-a721157.md "The authorization code flow with PKCE is recommended for public clients that aren’t capable of keeping the client secrets.")

